<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noda - Pagos Colombia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --nequi-color: #8dc63f;
            --daviplata-color: #f47920;
            --pse-color: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .payment-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .payment-header {
            background: linear-gradient(135deg, var(--primary-color), #2980b9);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .payment-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .payment-body {
            padding: 40px;
        }

        .order-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .order-summary h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .order-total {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--primary-color);
        }

        .payment-methods {
            margin-bottom: 30px;
        }

        .payment-methods h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .payment-option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }

        .payment-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .payment-option.selected {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .payment-option i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .payment-option.nequi i { color: var(--nequi-color); }
        .payment-option.daviplata i { color: var(--daviplata-color); }
        .payment-option.pse i { color: var(--pse-color); }
        .payment-option.tarjeta i { color: var(--primary-color); }
        .payment-option.efectivo i { color: var(--success-color); }

        .payment-form {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .payment-form.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .bank-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .bank-option {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bank-option:hover {
            background: #f8f9fa;
            border-color: var(--primary-color);
        }

        .bank-option.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .bank-logo {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .card-inputs {
            display: grid;
            gap: 15px;
        }

        .card-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .qr-container {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-color);
        }

        .instructions h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .pay-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .pay-button:hover {
            background: linear-gradient(135deg, #27ae60, var(--success-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
        }

        .pay-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: var(--accent-color);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-color);
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .success-message {
            background: #e8f5e8;
            color: var(--success-color);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--success-color);
            display: none;
        }

        .success-message.active {
            display: block;
        }

        .countdown {
            background: var(--warning-color);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .payment-options {
                grid-template-columns: 1fr 1fr;
            }
            
            .card-row {
                grid-template-columns: 1fr;
            }
            
            .bank-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <div class="payment-header">
            <h1><i class="fas fa-shield-alt"></i> Pago Seguro Noda</h1>
            <p>Todos tus datos est谩n protegidos con encriptaci贸n de nivel bancario</p>
        </div>

        <div class="payment-body">
            <!-- Resumen del pedido -->
            <div class="order-summary">
                <h3><i class="fas fa-shopping-cart"></i> Resumen de tu Compra</h3>
                <div class="order-item">
                    <span>Laptop Business Pro</span>
                    <span>$1,299,000 COP</span>
                </div>
                <div class="order-item">
                    <span>Servicio de Instalaci贸n</span>
                    <span>$150,000 COP</span>
                </div>
                <div class="order-item">
                    <span>Costo Domicilio</span>
                    <span>$50,000 COP</span>
                </div>
                <div class="order-total">
                    Total: $1,499,000 COP
                </div>
            </div>

            <!-- M茅todos de pago -->
            <div class="payment-methods">
                <h3><i class="fas fa-credit-card"></i> Selecciona tu M茅todo de Pago</h3>
                
                <div class="payment-options">
                    <div class="payment-option nequi" data-method="nequi">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Nequi</span>
                    </div>
                    <div class="payment-option daviplata" data-method="daviplata">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Daviplata</span>
                    </div>
                    <div class="payment-option pse" data-method="pse">
                        <i class="fas fa-university"></i>
                        <span>PSE</span>
                    </div>
                    <div class="payment-option tarjeta" data-method="tarjeta">
                        <i class="fas fa-credit-card"></i>
                        <span>Tarjeta</span>
                    </div>
                    <div class="payment-option efectivo" data-method="efectivo">
                        <i class="fas fa-money-bill"></i>
                        <span>Efectivo</span>
                    </div>
                </div>

                <!-- Formularios de pago -->
                
                <!-- Formulario Nequi -->
                <div class="payment-form" id="nequi-form">
                    <div class="instructions">
                        <h4> Pagar con Nequi</h4>
                        <ol>
                            <li>Ingresa tu n煤mero de celular registrado en Nequi</li>
                            <li>Recibir谩s un mensaje con el enlace de pago</li>
                            <li>Confirma el pago en tu app de Nequi</li>
                            <li>Espera la confirmaci贸n (m谩ximo 5 minutos)</li>
                        </ol>
                    </div>
                    
                    <div class="form-group">
                        <label for="nequi-phone">N煤mero de Celular Nequi</label>
                        <input type="tel" id="nequi-phone" placeholder="3001234567" maxlength="10" pattern="[0-9]{10}">
                    </div>
                    
                    <div class="form-group">
                        <label for="nequi-name">Nombre del Titular</label>
                        <input type="text" id="nequi-name" placeholder="Juan P茅rez">
                    </div>
                    
                    <div class="qr-container" id="nequi-qr" style="display: none;">
                        <h4>Escanea este c贸digo QR con Nequi</h4>
                        <div class="qr-code">
                            <i class="fas fa-qrcode" style="font-size: 3rem; color: #ccc;"></i>
                        </div>
                        <p>O haz clic aqu铆 para abrir autom谩ticamente</p>
                    </div>
                    
                    <button class="pay-button" onclick="processNequiPayment()">
                        <i class="fas fa-mobile-alt"></i> Pagar con Nequi
                    </button>
                </div>

                <!-- Formulario Daviplata -->
                <div class="payment-form" id="daviplata-form">
                    <div class="instructions">
                        <h4> Pagar con Daviplata</h4>
                        <ol>
                            <li>Ingresa tu n煤mero de celular registrado en Daviplata</li>
                            <li>Recibir谩s una notificaci贸n para confirmar el pago</li>
                            <li>Acepta el pago en tu app de Daviplata</li>
                            <li>La confirmaci贸n es inmediata</li>
                        </ol>
                    </div>
                    
                    <div class="form-group">
                        <label for="daviplata-phone">N煤mero de Celular Daviplata</label>
                        <input type="tel" id="daviplata-phone" placeholder="3001234567" maxlength="10" pattern="[0-9]{10}">
                    </div>
                    
                    <div class="form-group">
                        <label for="daviplata-id">N煤mero de Identificaci贸n</label>
                        <input type="text" id="daviplata-id" placeholder="123456789">
                    </div>
                    
                    <button class="pay-button" onclick="processDaviplataPayment()">
                        <i class="fas fa-money-bill-wave"></i> Pagar con Daviplata
                    </button>
                </div>

                <!-- Formulario PSE -->
                <div class="payment-form" id="pse-form">
                    <div class="instructions">
                        <h4> Pagar con PSE</h4>
                        <p>Paga directamente desde la banca en l铆nea de tu banco. Es seguro y no necesitas tarjeta.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="pse-bank">Selecciona tu Banco</label>
                        <div class="bank-grid" id="bank-list">
                            <!-- Los bancos se cargar谩n din谩micamente -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pse-type">Tipo de Persona</label>
                        <select id="pse-type">
                            <option value="">Seleccionar</option>
                            <option value="0">Persona Natural</option>
                            <option value="1">Persona Jur铆dica</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pse-id">N煤mero de Identificaci贸n</label>
                        <input type="text" id="pse-id" placeholder="123456789">
                    </div>
                    
                    <div class="form-group">
                        <label for="pse-name">Nombre Completo</label>
                        <input type="text" id="pse-name" placeholder="Juan P茅rez">
                    </div>
                    
                    <div class="form-group">
                        <label for="pse-email">Email</label>
                        <input type="email" id="pse-email" placeholder="juan@ejemplo.com">
                    </div>
                    
                    <button class="pay-button" onclick="processPSEPayment()">
                        <i class="fas fa-university"></i> Pagar con PSE
                    </button>
                </div>

                <!-- Formulario Tarjeta -->
                <div class="payment-form" id="tarjeta-form">
                    <div class="instructions">
                        <h4> Pagar con Tarjeta</h4>
                        <p>Aceptamos tarjetas de cr茅dito y d茅bito de todos los bancos colombianos.</p>
                    </div>
                    
                    <div class="card-inputs">
                        <div class="form-group">
                            <label for="card-number">N煤mero de Tarjeta</label>
                            <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        
                        <div class="form-group">
                            <label for="card-name">Nombre del Titular</label>
                            <input type="text" id="card-name" placeholder="JUAN PEREZ">
                        </div>
                        
                        <div class="card-row">
                            <div class="form-group">
                                <label for="card-expiry">Fecha de Vencimiento</label>
                                <input type="text" id="card-expiry" placeholder="MM/AA" maxlength="5">
                            </div>
                            
                            <div class="form-group">
                                <label for="card-cvv">CVV</label>
                                <input type="text" id="card-cvv" placeholder="123" maxlength="4">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="card-dues">Cuotas</label>
                            <select id="card-dues">
                                <option value="1">1 cuota - $1,499,000</option>
                                <option value="3">3 cuotas - $499,667/mes</option>
                                <option value="6">6 cuotas - $249,833/mes</option>
                                <option value="12">12 cuotas - $124,917/mes</option>
                                <option value="18">18 cuotas - $83,278/mes</option>
                                <option value="24">24 cuotas - $62,458/mes</option>
                                <option value="36">36 cuotas - $41,639/mes</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="card-email">Email para confirmaci贸n</label>
                            <input type="email" id="card-email" placeholder="juan@ejemplo.com">
                        </div>
                    </div>
                    
                    <button class="pay-button" onclick="processCardPayment()">
                        <i class="fas fa-lock"></i> Pagar Seguro
                    </button>
                </div>

                <!-- Formulario Efectivo -->
                <div class="payment-form" id="efectivo-form">
                    <div class="instructions">
                        <h4> Pagar en Efectivo</h4>
                        <p>Puedes pagar en nuestros puntos de atenci贸n o en puntos autorizados.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="efectivo-location">驴D贸nde deseas pagar?</label>
                        <select id="efectivo-location">
                            <option value="">Seleccionar ubicaci贸n</option>
                            <option value="tienda">Tienda Noda - Principal</option>
                            <option value="sucursal">Sucursal Noda - Norte</option>
                            <option value="baloto">Baloto</option>
                            <option value="efecty">Efecty</option>
                            <option value="sured">Sured</option>
                            <option value="giros">Giros y Finanzas</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="efectivo-name">Nombre Completo</label>
                        <input type="text" id="efectivo-name" placeholder="Juan P茅rez">
                    </div>
                    
                    <div class="form-group">
                        <label for="efectivo-id">N煤mero de Identificaci贸n</label>
                        <input type="text" id="efectivo-id" placeholder="123456789">
                    </div>
                    
                    <div class="form-group">
                        <label for="efectivo-phone">Tel茅fono</label>
                        <input type="tel" id="efectivo-phone" placeholder="3001234567">
                    </div>
                    
                    <div class="form-group">
                        <label for="efectivo-email">Email</label>
                        <input type="email" id="efectivo-email" placeholder="juan@ejemplo.com">
                    </div>
                    
                    <button class="pay-button" onclick="processCashPayment()">
                        <i class="fas fa-money-bill"></i> Generar Orden de Pago
                    </button>
                </div>
            </div>

            <!-- Mensajes de estado -->
            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Procesando tu pago...</p>
            </div>
            <div class="countdown" id="countdown" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Lista completa de bancos colombianos para PSE
        const colombianBanks = [
            { code: '1007', name: 'Bancolombia', logo: 'BC' },
            { code: '1002', name: 'Banco de Bogot谩', logo: 'BB' },
            { code: '1012', name: 'Banco Popular', logo: 'BP' },
            { code: '1001', name: 'Banco de Occidente', logo: 'BO' },
            { code: '1020', name: 'Banco GNB Sudameris', logo: 'GN' },
            { code: '1006', name: 'Banco BBVA Colombia', logo: 'BBVA' },
            { code: '1019', name: 'Banco Caja Social', logo: 'BCS' },
            { code: '1032', name: 'Banco Davivienda', logo: 'DV' },
            { code: '1052', name: 'Banco Agrario', logo: 'BA' },
            { code: '1009', name: 'Banco AV Villas', logo: 'AV' },
            { code: '1044', name: 'Banco Coopcentral', logo: 'CC' },
            { code: '1010', name: 'Bancoomeva', logo: 'BM' },
            { code: '1061', name: 'Banco Falabella', logo: 'BF' },
            { code: '1062', name: 'Banco Pichincha', logo: 'BP' },
            { code: '1066', name: 'Banco Mundo Mujer', logo: 'BM' },
            { code: '1014', name: 'Banco Serfinanza', logo: 'BS' },
            { code: '1065', name: 'Banco W', logo: 'BW' },
            { code: '1060', name: 'Banco Crediseguro', logo: 'BC' },
            { code: '1051', name: 'Banco Ita煤', logo: 'BI' },
            { code: '1058', name: 'Banco Santander', logo: 'BS' },
            { code: '1023', name: 'Banco Tequendama', logo: 'BT' },
            { code: '1028', name: 'Banco Finandina', logo: 'BF' },
            { code: '1030', name: 'Banco Compartir', logo: 'BC' },
            { code: '1031', name: 'Banco Pichincha', logo: 'BP' },
            { code: '1037', name: 'Banco Union Colombiano', logo: 'BUC' },
            { code: '1043', name: 'Banco Cooperativo Coopcentral', logo: 'BCC' },
            { code: '1056', name: 'Banco Procredit', logo: 'BP' },
            { code: '1067', name: 'Banco Caja Social', logo: 'BCS' },
            { code: '1072', name: 'Banco DAVIVIENDA', logo: 'DV' }
        ];

        // Variables globales
        let selectedPaymentMethod = null;
        let selectedBank = null;
        let paymentTimer = null;

        // Inicializaci贸n
        document.addEventListener('DOMContentLoaded', function() {
            loadBankList();
            setupPaymentMethodListeners();
            setupCardFormatting();
        });

        // Cargar lista de bancos
        function loadBankList() {
            const bankList = document.getElementById('bank-list');
            bankList.innerHTML = '';
            
            colombianBanks.forEach(bank => {
                const bankOption = document.createElement('div');
                bankOption.className = 'bank-option';
                bankOption.dataset.bankCode = bank.code;
                bankOption.innerHTML = `
                    <div class="bank-logo">${bank.logo}</div>
                    <span>${bank.name}</span>
                `;
                bankOption.addEventListener('click', () => selectBank(bank));
                bankList.appendChild(bankOption);
            });
        }

        // Seleccionar banco
        function selectBank(bank) {
            document.querySelectorAll('.bank-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-bank-code="${bank.code}"]`).classList.add('selected');
            selectedBank = bank;
        }

        // Configurar listeners de m茅todos de pago
        function setupPaymentMethodListeners() {
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function() {
                    const method = this.dataset.method;
                    selectPaymentMethod(method);
                });
            });
        }

        // Seleccionar m茅todo de pago
        function selectPaymentMethod(method) {
            // Actualizar UI
            document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector(`[data-method="${method}"]`).classList.add('selected');
            
            // Ocultar todos los formularios
            document.querySelectorAll('.payment-form').forEach(form => form.classList.remove('active'));
            
            // Mostrar formulario seleccionado
            document.getElementById(`${method}-form`).classList.add('active');
            
            selectedPaymentMethod = method;
            hideMessages();
        }

        // Formato de tarjeta
        function setupCardFormatting() {
            const cardNumber = document.getElementById('card-number');
            const cardExpiry = document.getElementById('card-expiry');
            const cardCvv = document.getElementById('card-cvv');
            
            if (cardNumber) {
                cardNumber.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s/g, '');
                    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                    e.target.value = formattedValue;
                });
            }
            
            if (cardExpiry) {
                cardExpiry.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        value = value.slice(0, 2) + '/' + value.slice(2, 4);
                    }
                    e.target.value = value;
                });
            }
            
            if (cardCvv) {
                cardCvv.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/\D/g, '');
                });
            }
        }

        // Procesar pago Nequi
        async function processNequiPayment() {
            const phone = document.getElementById('nequi-phone').value;
            const name = document.getElementById('nequi-name').value;
            
            if (!phone || !name) {
                showError('Por favor completa todos los campos');
                return;
            }
            
            if (!validatePhone(phone)) {
                showError('El n煤mero de celular no es v谩lido');
                return;
            }
            
            showLoading();
            
            try {
                // Simular llamada a API de Nequi
                const response = await simulateNequiPayment({
                    phone: phone,
                    name: name,
                    amount: 1499000,
                    description: 'Compra Noda Tech'
                });
                
                if (response.success) {
                    // Mostrar QR
                    document.getElementById('nequi-qr').style.display = 'block';
                    
                    // Iniciar contador
                    startCountdown(300, () => {
                        checkNequiStatus(response.transactionId);
                    });
                    
                    showSuccess('隆Listo! Revisa tu app de Nequi para confirmar el pago');
                } else {
                    showError(response.message || 'Error al procesar el pago con Nequi');
                }
            } catch (error) {
                showError('Error de conexi贸n. Intenta nuevamente.');
            } finally {
                hideLoading();
            }
        }

        // Procesar pago Daviplata
        async function processDaviplataPayment() {
            const phone = document.getElementById('daviplata-phone').value;
            const id = document.getElementById('daviplata-id').value;
            
            if (!phone || !id) {
                showError('Por favor completa todos los campos');
                return;
            }
            
            showLoading();
            
            try {
                const response = await simulateDaviplataPayment({
                    phone: phone,
                    identification: id,
                    amount: 1499000,
                    description: 'Compra Noda Tech'
                });
                
                if (response.success) {
                    showSuccess('隆Listo! Revisa tu app de Daviplata para confirmar el pago');
                    
                    // Verificar estado
                    setTimeout(() => {
                        checkDaviplataStatus(response.transactionId);
                    }, 5000);
                } else {
                    showError(response.message || 'Error al procesar el pago con Daviplata');
                }
            } catch (error) {
                showError('Error de conexi贸n. Intenta nuevamente.');
            } finally {
                hideLoading();
            }
        }

        // Procesar pago PSE
        async function processPSEPayment() {
            if (!selectedBank) {
                showError('Por favor selecciona tu banco');
                return;
            }
            
            const type = document.getElementById('pse-type').value;
            const id = document.getElementById('pse-id').value;
            const name = document.getElementById('pse-name').value;
            const email = document.getElementById('pse-email').value;
            
            if (!type || !id || !name || !email) {
                showError('Por favor completa todos los campos');
                return;
            }
            
            showLoading();
            
            try {
                const response = await simulatePSEPayment({
                    bank: selectedBank,
                    userType: type,
                    identification: id,
                    name: name,
                    email: email,
                    amount: 1499000,
                    description: 'Compra Noda Tech',
                    returnURL: 'https://noda.tech/payment/confirmation',
                    reference: 'NODA_' + Date.now()
                });
                
                if (response.success) {
                    // Redirigir al banco
                    window.open(response.paymentURL, '_blank');
                    
                    showSuccess('Ser谩s redirigido a la p谩gina de tu banco para completar el pago');
                    
                    // Iniciar verificaci贸n
                    startCountdown(600, () => {
                        checkPSEStatus(response.transactionId);
                    });
                } else {
                    showError(response.message || 'Error al procesar el pago con PSE');
                }
            } catch (error) {
                showError('Error de conexi贸n. Intenta nuevamente.');
            } finally {
                hideLoading();
            }
        }

        // Procesar pago con tarjeta
        async function processCardPayment() {
            const cardNumber = document.getElementById('card-number').value;
            const cardName = document.getElementById('card-name').value;
            const cardExpiry = document.getElementById('card-expiry').value;
            const cardCvv = document.getElementById('card-cvv').value;
            const cardEmail = document.getElementById('card-email').value;
            const cardDues = document.getElementById('card-dues').value;
            
            if (!cardNumber || !cardName || !cardExpiry || !cardCvv || !cardEmail) {
                showError('Por favor completa todos los campos');
                return;
            }
            
            if (!validateCard(cardNumber)) {
                showError('El n煤mero de tarjeta no es v谩lido');
                return;
            }
            
            showLoading();
            
            try {
                const response = await simulateCardPayment({
                    cardNumber: cardNumber.replace(/\s/g, ''),
                    cardName: cardName,
                    cardExpiry: cardExpiry,
                    cardCvv: cardCvv,
                    email: cardEmail,
                    dues: cardDues,
                    amount: 1499000,
                    description: 'Compra Noda Tech'
                });
                
                if (response.success) {
                    showSuccess('隆Pago aprobado! Recibir谩s un email de confirmaci贸n');
                    
                    // Redirigir a p谩gina de confirmaci贸n
                    setTimeout(() => {
                        window.location.href = '/payment/success?order=' + response.orderId;
                    }, 3000);
                } else {
                    showError(response.message || 'Error al procesar el pago');
                }
            } catch (error) {
                showError('Error de conexi贸n. Intenta nuevamente.');
            } finally {
                hideLoading();
            }
        }

        // Procesar pago en efectivo
        async function processCashPayment() {
            const location = document.getElementById('efectivo-location').value;
            const name = document.getElementById('efectivo-name').value;
            const id = document.getElementById('efectivo-id').value;
            const phone = document.getElementById('efectivo-phone').value;
            const email = document.getElementById('efectivo-email').value;
            
            if (!location || !name || !id || !phone) {
                showError('Por favor completa todos los campos');
                return;
            }
            
            showLoading();
            
            try {
                const response = await simulateCashPayment({
                    location: location,
                    name: name,
                    identification: id,
                    phone: phone,
                    email: email,
                    amount: 1499000,
                    description: 'Compra Noda Tech',
                    reference: 'NODA_' + Date.now()
                });
                
                if (response.success) {
                    showSuccess('隆Orden generada! Presenta este c贸digo en el punto de pago: ' + response.reference);
                    
                    // Mostrar c贸digo de barras o QR
                    showPaymentReference(response.reference);
                } else {
                    showError(response.message || 'Error al generar la orden');
                }
            } catch (error) {
                showError('Error de conexi贸n. Intenta nuevamente.');
            } finally {
                hideLoading();
            }
        }

        // Funciones de validaci贸n
        function validatePhone(phone) {
            return /^3[0-9]{9}$/.test(phone);
        }

        function validateCard(cardNumber) {
            const cleaned = cardNumber.replace(/\s/g, '');
            return /^\d{13,19}$/.test(cleaned) && luhnCheck(cleaned);
        }

        function luhnCheck(cardNumber) {
            let sum = 0;
            let isEven = false;
            
            for (let i = cardNumber.length - 1; i >= 0; i--) {
                let digit = parseInt(cardNumber[i]);
                
                if (isEven) {
                    digit *= 2;
                    if (digit > 9) {
                        digit = digit % 10 + 1;
                    }
                }
                
                sum += digit;
                isEven = !isEven;
            }
            
            return sum % 10 === 0;
        }

        // Funciones de UI
        function showLoading() {
            document.getElementById('loading').classList.add('active');
            hideMessages();
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.classList.add('active');
            hideLoading();
        }

        function showSuccess(message) {
            const successElement = document.getElementById('success-message');
            successElement.textContent = message;
            successElement.classList.add('active');
            hideLoading();
        }

        function hideMessages() {
            document.getElementById('error-message').classList.remove('active');
            document.getElementById('success-message').classList.remove('active');
        }

        function startCountdown(seconds, callback) {
            const countdownElement = document.getElementById('countdown');
            countdownElement.style.display = 'block';
            
            let remaining = seconds;
            
            paymentTimer = setInterval(() => {
                const minutes = Math.floor(remaining / 60);
                const secs = remaining % 60;
                countdownElement.textContent = `Tiempo restante: ${minutes}:${secs.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    clearInterval(paymentTimer);
                    countdownElement.style.display = 'none';
                    callback();
                }
                
                remaining--;
            }, 1000);
        }

        function showPaymentReference(reference) {
            const referenceDiv = document.createElement('div');
            referenceDiv.className = 'payment-reference';
            referenceDiv.innerHTML = `
                <h4>C贸digo de Referencia</h4>
                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color); margin: 20px 0;">
                    ${reference}
                </div>
                <p>Presenta este c贸digo en el punto de pago seleccionado</p>
                <button onclick="window.print()" class="pay-button" style="margin-top: 20px;">
                    <i class="fas fa-print"></i> Imprimir Referencia
                </button>
            `;
            
            document.querySelector('.payment-body').appendChild(referenceDiv);
        }

        // Simulaciones de API (reemplazar con llamadas reales)
        async function simulateNequiPayment(data) {
            // Simular delay de red
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Simular respuesta exitosa
            return {
                success: true,
                transactionId: 'NEQ_' + Date.now(),
                qrCode: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
            };
        }

        async function simulateDaviplataPayment(data) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            return {
                success: true,
                transactionId: 'DAV_' + Date.now()
            };
        }

        async function simulatePSEPayment(data) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            return {
                success: true,
                transactionId: 'PSE_' + Date.now(),
                paymentURL: `https://sandbox.wompi.co/v1/transactions/${data.reference}`
            };
        }

        async function simulateCardPayment(data) {
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            return {
                success: true,
                orderId: 'ORD_' + Date.now(),
                authorizationCode: 'AUTH_' + Math.random().toString(36).substr(2, 9).toUpperCase()
            };
        }

        async function simulateCashPayment(data) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            return {
                success: true,
                reference: data.reference
            };
        }

        // Funciones de verificaci贸n de estado
        async function checkNequiStatus(transactionId) {
            // Implementar verificaci贸n real con API de Nequi
            console.log('Verificando estado de Nequi:', transactionId);
        }

        async function checkDaviplataStatus(transactionId) {
            // Implementar verificaci贸n real con API de Daviplata
            console.log('Verificando estado de Daviplata:', transactionId);
        }

        async function checkPSEStatus(transactionId) {
            // Implementar verificaci贸n real con API de PSE/Wompi
            console.log('Verificando estado de PSE:', transactionId);
        }
    </script>
</body>
</html>
